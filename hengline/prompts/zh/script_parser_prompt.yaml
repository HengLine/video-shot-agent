# 剧本解析相关提示词模板
version: "1.2"

# 自然语言转结构化分镜，提示词模板
natural_language_parser:
  name: "natural_language_prompt"
  description: "初始剧本解析，重点提取场景结构、角色和基本动作序列"
  template: |
    你是一个专业的剧本分析AI。请分析以下自然语言剧本，提取结构化信息。
    
    ## 剧本内容：
    {script_text}
    
    ## 提取要求：
    1. 识别所有角色（注意：同一个人可能有不同称呼）
    2. 将剧本按场景逻辑分割
    3. 提取每个场景的：地点、时间、氛围
    4. 分离对话内容和动作描述
    5. 为每个动作标注类型和强度
    
    ## 输出严格的JSON格式：
    {
      "scenes": [
        {
          "scene_id": "scene_001",
          "description": "场景的主要内容描述",
          "location": "具体地点",
          "time_of_day": "时间（白天/夜晚/黄昏等）",
          "mood": "氛围（紧张/轻松/悲伤等）",
          "characters": ["出现的角色名列表"],
          "dialogue_ids": ["本场景对话ID列表"],
          "action_ids": ["本场景动作ID列表"]
        }
      ],
      "characters": [
        {
          "name": "角色名",
          "age": 估算年龄（如无法确定则为null）,
          "gender": "性别（男/女/未知）",
          "role_hint": "角色提示（主角/配角/群众）"
        }
      ],
      "dialogues": [
        {
          "dialogue_id": "dialogue_001",
          "speaker": "说话者",
          "text": "对话内容",
          "emotion": "情绪（平静/愤怒/悲伤等）",
          "scene_ref": "所属场景ID"
        }
      ],
      "actions": [
        {
          "action_id": "action_001",
          "type": "动作类型（walk/run/sit/stand/look等）",
          "actor": "执行者",
          "description": "动作描述",
          "intensity": 强度（1-5，1最弱，5最强）,
          "scene_ref": "所属场景ID"
        }
      ],
      "parsing_confidence": {
        "character_recognition": 0.9,
        "scene_segmentation": 0.8,
        "dialogue_extraction": 0.85
      }
    }
    
    ## 注意事项：
    - 保持原始文本的语义，不做修改
    - 如果信息不确定，使用null或合理推断
    - 确保ID的唯一性和对应关系

# AI分镜转标准格式，提示词模板
ai_storyboard_parser:
  name: "ai_storyboard_prompt"
  description: "AI分镜转标准格式"
  template: |
    你是一个专业的影视分镜分析师。请分析以下AI生成的分镜剧本，并增强其解析结果。
    
    ## 原始分镜剧本：
    {original_storyboard}
    
    ## 当前解析结果（需要增强）：
    {parsed_scenes}
    
    ## 增强任务：
    1. **场景理解增强**：基于分镜描述，提供更丰富的场景背景和上下文
    2. **角色关系分析**：识别角色之间的潜在关系和情感联系
    3. **情绪氛围识别**：分析每个分镜的情绪基调和氛围
    4. **动作连贯性**：检查分镜间的动作是否连贯，建议改进
    5. **视觉细节补充**：补充缺失的视觉元素和细节
    
    ## 增强要求：
    - 保持原有结构，只做增强和补充
    - 不改变原始的时间和分段结构
    - 补充的信息要基于分镜内容合理推断
    - 为每个场景添加"enhanced_description"字段
    - 为每个场景添加"emotional_tone"字段（1-10分）
    - 识别关键的情感转折点
    
    ## 输出格式（JSON）：
    {{
      "enhanced_scenes": [
        {{
          "scene_id": "与原scene_id对应",
          "enhanced_description": "增强后的场景描述（更丰富、更连贯）",
          "emotional_tone": "情绪基调评分 1-10",
          "key_elements": ["关键视觉/情感元素"],
          "character_relationships": "角色关系分析",
          "transition_suggestion": "与前后场景的过渡建议"
        }}
      ],
      
      "overall_analysis": {{
        "story_arc": "整体故事弧分析",
        "pace_analysis": "节奏分析",
        "visual_consistency": "视觉一致性评估",
        "emotional_journey": "情感旅程分析"
      }},
      
      "enhancement_confidence": 0.9
    }}
    
    请输出纯净的JSON。


screenplay_format_parser:
  name: "screenplay_format_prompt"
  description: "标准剧本格式解析"
  template: |
    你是一个专业的剧本分析AI。请解析以下标准格式剧本，提取所有结构化信息。
    
    ## 剧本格式说明：
    这是一个标准剧本格式，包含：
    1. 场景标题：INT./EXT. 地点 - 时间
    2. 动作描述：普通段落，描述角色动作和环境
    3. 角色名：全大写单独一行
    4. 对话：在角色名下方，通常有缩进
    5. 表演提示：(括号内的内容)
    6. 转场：CUT TO:, FADE IN: 等
    
    ## 剧本内容：
    {script_text}
    
    ## 解析要求：
    1. 识别所有场景，基于slugline
    2. 提取每个场景的地点、时间、参与角色
    3. 分离动作描述和对话内容
    4. 识别角色关系和情绪状态
    5. 保持剧本的原始结构和顺序
    6. 为对话标注情绪，为动作标注类型
    
    ## 输出格式（严格的JSON）：
    {{
      "scenes": [
        {{
          "scene_id": "scene_001",
          "slugline": "原始场景标题",
          "description": "场景的主要内容描述（合并动作描述）",
          "location": "地点",
          "time_of_day": "时间（白天/夜晚/早晨/下午/傍晚）",
          "mood": "氛围",
          "characters": ["出现的角色名"],
          "action_blocks": [
            {{
              "text": "动作描述文本",
              "characters_involved": ["涉及的角色"]
            }}
          ]
        }}
      ],
      
      "characters": [
        {{
          "name": "角色名",
          "first_scene": "首次出现的场景ID",
          "dialogue_count": "对话次数",
          "gender": "性别推断",
          "importance": "重要性评分（1-10）"
        }}
      ],
      
      "dialogues": [
        {{
          "dialogue_id": "dialogue_001",
          "speaker": "说话者",
          "text": "对话内容",
          "emotion": "情绪",
          "scene_ref": "所属场景ID",
          "parenthetical": "表演提示（如果有）"
        }}
      ],
      
      "actions": [
        {{
          "action_id": "action_001",
          "type": "动作类型",
          "actor": "执行者",
          "description": "动作描述",
          "intensity": "强度（1-5）",
          "scene_ref": "所属场景ID"
        }}
      ],
      
      "metadata": {{
        "title": "剧本标题（如果找到）",
        "author": "作者（如果找到）",
        "scene_count": "场景总数",
        "character_count": "角色总数",
        "estimated_length": "估计页数/时长"
      }},
      
      "parsing_confidence": {{
        "scene_recognition": "场景识别置信度（0-1）",
        "character_recognition": "角色识别置信度（0-1）",
        "dialogue_extraction": "对话提取置信度（0-1）",
        "overall": "整体置信度（0-1）"
      }}
    }}
    
    ## 特别注意：
    1. 严格遵循标准剧本格式规则
    2. 保留原始文本，不做修改
    3. 正确处理缩进和格式
    4. 识别转场和场景变化
    5. 输出必须是纯净的JSON
    

structured_scene_parser:
  name: "structured_scene_prompt"
  description: "结构化场景解析"
  template: |
    你是一个专业的剧本解析AI。请解析以下结构化分场剧本，提取所有信息。
    
    ## 剧本格式说明：
    这是一个结构化分场剧本，包含以下字段：
    - 场景/场次：场景编号或标题
    - 地点：场景发生的地点
    - 时间：场景发生的时间
    - 人物/角色：参与该场景的角色列表
    - 内容/情节：场景的主要内容描述
    - 对话：角色之间的对话
    - 动作：角色的动作描述
    - 氛围：场景的情绪氛围
    
    ## 剧本内容：
    {script_text}
    
    ## 解析要求：
    1. 识别所有场景，即使它们没有明确的"场景"标记
    2. 从每个场景中提取：地点、时间、参与角色
    3. 分离场景描述、对话内容和动作描述
    4. 为每个角色推断年龄、性别和角色类型
    5. 为对话标注情绪状态
    6. 为动作标注类型和强度
    
    ## 输出格式（严格的JSON）：
    {{
      "scenes": [
        {{
          "scene_id": "自动生成的场景ID，如scene_001",
          "description": "场景的主要内容描述",
          "location": "地点",
          "time_of_day": "时间（清晨/上午/中午/下午/傍晚/夜晚/凌晨）",
          "mood": "氛围（紧张/悲伤/欢乐/浪漫/恐怖等）",
          "characters": ["角色名列表"],
          "content": "原始内容文本"
        }}
      ],
      
      "characters": [
        {{
          "name": "角色名",
          "age": "估算年龄（如无法确定则为null）",
          "gender": "性别（男/女/未知）",
          "role_hint": "角色提示（主角/配角/群众）",
          "description": "角色描述"
        }}
      ],
      
      "dialogues": [
        {{
          "speaker": "说话者",
          "text": "对话内容",
          "emotion": "情绪（平静/愤怒/悲伤/高兴/惊讶/恐惧）",
          "scene_ref": "所属场景ID"
        }}
      ],
      
      "actions": [
        {{
          "type": "动作类型（walk/run/sit/stand/look/smile/cry/touch等）",
          "actor": "执行者",
          "description": "动作描述",
          "intensity": "强度（1-5，1最弱，5最强）",
          "scene_ref": "所属场景ID"
        }}
      ],
      
      "parsing_confidence": {{
        "scene_detection": "场景检测置信度（0-1）",
        "character_recognition": "角色识别置信度（0-1）",
        "dialogue_extraction": "对话提取置信度（0-1）",
        "action_extraction": "动作提取置信度（0-1）",
        "overall": "整体置信度（0-1）"
      }}
    }}
    
    ## 特别注意：
    1. 保持原始文本的语义，不做修改
    2. 如果信息不确定，使用null或合理推断
    3. 确保场景ID的唯一性
    4. 确保角色、对话、动作与场景的正确关联
    5. 输出必须是纯粹的JSON，不要有其他文本
    

script_parser_validator:
  name: "script_parser_prompt"
  description: "剧本解析验证"
  template: |
    你是一个剧本验证系统。请检查以下解析结果，识别问题并提供修复建议。
    
    ## 验证规则：
    1. 时间线必须连续且合理
    2. 角色名称必须一致
    3. 地点转换必须逻辑通顺
    4. 镜头描述必须可执行
    5. 情绪发展必须连贯
    
    ## 问题剧本：
    {problematic_script}
    
    ## 当前解析结果：
    {current_parsing}
    
    ## 发现的问题：
    {detected_issues}
    
    ## 请提供：
    1. 问题分类和严重程度
    2. 具体修复建议
    3. 修正后的关键字段
    4. 防止类似问题的规则
    
    输出JSON格式：
    {
      "validation_report": {
        "overall_status": "valid|needs_minor_fixes|needs_major_revision",
        "issues_found": [
          {
            "type": "问题类型",
            "description": "问题描述",
            "severity": "high|medium|low",
            "location": "问题位置",
            "suggestion": "修复建议"
          }
        ]
      },
    
      "corrected_content": {
        "timeline_fixes": [
          {"original": "原始时间", "corrected": "修正时间"}
        ],
        "character_consistency_fixes": [
          {"inconsistent_name": "不一致的名称", "standardized_to": "标准化名称"}
        ],
        "location_clarifications": [
          {"vague_location": "模糊地点", "clarified_to": "明确地点"}
        ]
      },
    
      "preventive_rules": [
        "预防规则1",
        "预防规则2"
      ]
    }