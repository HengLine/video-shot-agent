# 剧本解析相关提示词模板
version: "1.2"

# 自然语言转结构化分镜，提示词模板
natural_language_parser:
  name: "natural_language_prompt"
  description: "初始剧本解析，重点提取场景结构、角色和基本动作序列"
  template: |
    你是一个专业的影视分镜师。请将以下自然语言剧本转换为详细的结构化分镜剧本。
  
    ## 转换要求：
    1. 按时间顺序分割成5-30秒的片段
    2. 每个片段必须包含完整信息
    3. 标注视觉衔接点
    4. 识别角色状态变化
    5. 指定摄像机运动和灯光
  
    ## 输出格式（JSON）：
    {{
      "script_metadata": {{
        "title": "剧本标题",
        "estimated_duration": "总时长（秒）",
        "main_characters": ["角色列表"],
        "primary_locations": ["主要地点"],
        "time_progression": ["时间线"]
      }},
      "segments": [
        {{
          "segment_id": 1,
          "time_range": [0, 15],
          "duration": 15,
          "location": "具体地点",
          "time_of_day": "时间",
          "weather": "天气",
  
          "visual_description": "详细的视觉描述（不少于50字）",
          "key_visual_elements": ["关键视觉元素列表"],
  
          "characters": [
            {{
              "name": "角色名",
              "appearance": {{"服装": "描述", "发型": "描述", "状态": "描述"}},
              "action": "当前动作",
              "emotion": "情绪状态"
            }}
          ],
  
          "camera_specs": {{
            "shot_type": "镜头类型",
            "lens": "镜头焦距",
            "movement": "摄像机运动",
            "framing": "构图",
            "angle": "角度"
          }},
  
          "lighting_specs": {{
            "type": "灯光类型",
            "direction": "光源方向",
            "quality": "光质",
            "color_temp": "色温"
          }},
  
          "audio_elements": {{
            "dialogue": ["对话内容"],
            "sound_effects": ["音效"],
            "background_sound": "背景声",
            "music": "音乐描述"
          }},
  
          "continuity_hooks": {{
            "previous_segment_match": "如何衔接前一段",
            "next_segment_prepare": "如何准备下一段",
            "visual_consistency": ["需要保持一致的视觉元素"]
          }}
        }}
      ],
  
      "continuity_tracking": {{
        "character_arcs": {{
          "角色名": {
            "appearance_changes": [
              {"segment": 1, "change": "变化描述"}
            ],
            "emotional_journey": [
              {"segment": 1, "emotion": "情绪", "intensity": 0-10}
            ]
          }}
        }},
        "environment_progression": [
          {{"segment": 1, "location": "地点", "time": "时间", "changes": "变化"}}
        ]
      }}
    }}
  
    ## 剧本内容：
    {script_text}
  
    ## 特别注意：
    1. 对话场景要保持连贯性
    2. 动作序列要分解为多个镜头
    3. 时间跳跃要标注清楚
    4. 情绪转变要平滑过渡
    5. 为Sora视频生成优化描述
    
    请输出纯净的JSON，不要任何额外文本。

# AI分镜转标准格式，提示词模板
ai_storyboard_parser:
  name: "ai_storyboard_prompt"
  description: "AI分镜转标准格式"
  template: |
    你是一个视频制作专家。请将以下AI生成的分镜剧本转换为标准的、可用于Sora视频生成的结构化格式。

    ## 输入格式特征（AI分镜）：
    - 按时间段分段 [0-5秒], [6-10秒]
    - 包含画面、声音、动作等标签
    - 可能有简化的描述
    
    ## 转换要求：
    1. 补全缺失的视觉细节
    2. 统一时间标记为连续时间线
    3. 提取并详细描述角色
    4. 补充摄像机、灯光、音效信息
    5. 确保片段间的平滑过渡
    
    ## 输出格式（JSON）：
    {
      "source_format": "ai_storyboard",
      "segments": [
        {
          "original_time_marker": "[0-5秒]",  // 原始时间标记
          "corrected_time_range": [0, 5],     // 修正后的时间范围
          "duration": 5,                      // 时长
          
          // 从输入中提取的原始内容
          "raw_content": {
            "画面": "原始画面描述",
            "声音": "原始声音描述",
            "动作": "原始动作描述"
          },
          
          // 增强后的完整内容
          "enhanced_content": {
            "location": "推断的地点",
            "time_of_day": "推断的时间",
            "weather": "推断的天气",
            
            "visual_description": "增强的视觉描述（基于原始画面补充细节）",
            "character_details": [
              {
                "name": "推断的角色名",
                "appearance": "根据上下文推断的外观",
                "action": "具体的动作分解",
                "position": "在画面中的位置"
              }
            ],
            
            "camera_enhancement": {
              "inferred_shot_type": "根据描述推断的镜头类型",
              "recommended_lens": "推荐的镜头",
              "movement_suggestion": "建议的摄像机运动"
            },
            
            "lighting_enhancement": {
              "mood": "根据场景推断的情绪氛围",
              "lighting_type": "建议的灯光类型",
              "color_scheme": "建议的色彩方案"
            },
            
            "audio_enhancement": {
              "dialogue_parsed": ["解析出的对话"],
              "sound_effects_enhanced": ["增强的音效描述"],
              "background_score": "建议的背景音乐"
            }
          },
          
          "continuity_analysis": {
            "links_to_previous": "如何连接到前一段",
            "sets_up_next": "如何为下一段铺垫",
            "consistency_checks": ["需要检查的一致性项目"]
          }
        }
      ],
      
      "global_enhancements": {
        "character_identification": {
          "identified_characters": [
            {
              "name": "角色名",
              "first_appearance": "首次出现的片段",
              "appearance_consistency": "外观一致性要求"
            }
          ]
        },
        
        "timeline_validation": {
          "time_jumps": [
            {"from_segment": 1, "to_segment": 2, "jump_type": "时间跳跃类型"}
          ],
          "continuity_issues": ["发现的连续性问题"]
        },
        
        "production_notes": {
          "special_effects_needed": ["需要的特效"],
          "difficulty_level": "制作难度评估",
          "estimated_cost_factors": ["成本影响因素"]
        }
      }
    }
    
    ## AI分镜剧本内容：
    {ai_storyboard_text}
    
    ## 转换规则：
    1. 如果时间标记不连续，自动调整时间线
    2. 如果角色名称模糊，使用描述性名称（如"穿红裙的女人"）
    3. 补充合理的环境细节
    4. 为每个片段建议合适的镜头语言
    5. 确保情绪连贯性
    
    请输出纯净的JSON，不要任何额外文本。


screenplay_format_parser:
  name: "screenplay_format_prompt"
  description: "标准剧本格式解析"
  template: |
    你是一个好莱坞剧本医生。请将以下标准格式剧本转换为详细的视频生成指令，特别优化用于AI视频生成工具如Sora。
    
    ## 标准剧本格式特征：
    - 场景标题 (INT./EXT.)
    - 角色名全大写
    - 对话缩进
    - 动作描述
    - 转场指示
    
    ## 转换要求：
    1. 保持原始剧本的结构和节奏
    2. 将每个场景分解为可执行的镜头
    3. 详细描述视觉风格和摄影
    4. 提取角色发展和情感弧线
    5. 为每个镜头生成Sora优化提示
    
    ## 输出格式（JSON）：
    {
      "screenplay_metadata": {
        "title": "剧本标题",
        "author": "作者",
        "scenes_count": 场景数量,
        "estimated_runtime": "预计时长",
        "genre": ["类型"],
        "logline": "一句话梗概"
      },
    
      "scenes_detailed": [
        {
          "scene_number": 1,
          "original_header": "原始场景标题",
          "slugline": {
            "int_ext": "室内/外",
            "location": "地点",
            "time_of_day": "时间"
          },
    
          "action_analysis": {
            "action_blocks": [
              {
                "block_id": "动作块ID",
                "text": "动作文本",
                "duration_estimate": 5,
                "key_visuals": ["关键视觉"],
                "camera_implication": "隐含的摄像机指示"
              }
            ],
    
            "character_entrances": ["角色入场"],
            "character_exits": ["角色退场"],
            "prop_usage": ["道具使用"]
          },
    
          "dialogue_analysis": [
            {
              "character": "角色名",
              "line": "台词原文",
              "parenthetical": "(表演提示)",
              "emotional_tone": "情绪基调",
              "subtext_analysis": "潜台词分析",
    
              "delivery_specs": {
                "pacing": "节奏",
                "volume": "音量",
                "emphasis": "重音",
                "body_language": "肢体语言"
              },
    
              "shot_recommendation": {
                "for_this_line": "适合这句台词的镜头",
                "reaction_shot": "反应镜头建议"
              }
            }
          ],
    
          "shot_list": [
            {
              "shot_number": "镜头号",
              "type": "镜头类型",
              "description": "镜头描述",
              "duration": 镜头时长,
    
              "sora_prompt_components": {
                "visual_description": "视觉描述",
                "camera_specs": "摄像机规格",
                "lighting_specs": "灯光规格",
                "character_blocking": "角色走位"
              },
    
              "continuity_notes": {
                "matches_previous": "如何匹配前一个镜头",
                "leads_to_next": "如何引导到下一个镜头"
              }
            }
          ],
    
          "production_notes": {
            "set_requirements": "场景要求",
            "lighting_setup": "灯光布置",
            "sound_requirements": "声音要求",
            "special_effects": "特效需求"
          }
        }
      ],
    
      "character_arcs": {
        "character_name": {
          "appearance": "外貌描述",
          "costume_arc": [
            {"scene": 1, "costume": "服装", "state": "状态"}
          ],
          "emotional_journey": [
            {"scene": 1, "emotion": "情绪", "intensity": 强度}
          ],
          "relationships": {
            "with_character": "关系类型",
            "development": "关系发展"
          }
        }
      },
    
      "visual_style_guide": {
        "color_palette": {
          "overall": "整体色调",
          "per_scene": [
            {"scene": 1, "palette": "色彩方案", "mood": "营造的情绪"}
          ]
        },
    
        "cinematography_style": {
          "camera_movement_style": "摄像机运动风格",
          "lens_characteristics": "镜头特征",
          "framing_philosophy": "构图哲学"
        },
    
        "lighting_scheme": {
          "overall_approach": "整体灯光方案",
          "key_scenes_lighting": [
            {"scene": 1, "lighting": "具体灯光方案"}
          ]
        }
      },
    
      "sora_generation_plan": {
        "scene_generation_order": ["场景生成顺序"],
        "character_consistency_tokens": {
          "character_name": "用于Sora的角色一致性token"
        },
        "style_embedding_prompts": ["风格嵌入提示词"],
        "transition_strategies": [
          {
            "from_scene": 1,
            "to_scene": 2,
            "method": "过渡方法",
            "sora_prompt": "Sora过渡提示"
          }
        ]
      }
    }
    
    ## 标准剧本内容：
    {screenplay_text}
    
    ## 转换规则：
    1. 尊重原始剧本的格式和意图
    2. 为对话场景建议合适的正反打镜头
    3. 识别并标注关键的情感时刻
    4. 为动作场景设计连贯的镜头序列
    5. 确保时间连续性和空间一致性
    
    请输出纯净的JSON，不要任何额外文本。
    

structured_scene_parser:
  name: "structured_scene_prompt"
  description: "结构化场景解析"
  template: |
    你是一个专业的剧本分析师。请分析以下结构化场景剧本，提取所有制作要素并为Sora视频生成优化。

    ## 输入格式特征（结构化场景）：
    - 明确的场景划分
    - 格式化的字段（场景、时间、人物、内容）
    - 可能有分镜头指示
    
    ## 分析要求：
    1. 识别并验证所有结构化字段
    2. 将内容分解为可拍摄的镜头
    3. 提取角色交互和动作序列
    4. 推断摄像机位置和运动
    5. 分析场景间的过渡需求
    
    ## 输出格式（JSON）：
    {
      "scene_analysis": [
        {
          "scene_id": "场景标识",
          "original_header": "原始场景标题",
    
          "parsed_elements": {
            "location": "解析出的地点",
            "time": {"raw": "原始时间", "parsed": "解析后的时间"},
            "characters": ["解析出的角色列表"],
            "content_summary": "内容摘要"
          },
    
          "shot_breakdown": [
            {
              "shot_id": "镜头ID",
              "estimated_duration": 5,
              "description": "镜头描述",
              "characters_in_shot": ["该镜头中的角色"],
              "key_action": "关键动作",
    
              "camera_recommendation": {
                "shot_size": "景别",
                "angle": "角度",
                "movement": "运动",
                "lens_suggestion": "镜头建议"
              },
    
              "lighting_recommendation": {
                "key_light": "主光",
                "fill_light": "补光",
                "back_light": "背光",
                "mood": "灯光营造的氛围"
              }
            }
          ],
    
          "dialogue_analysis": [
            {
              "speaker": "说话者",
              "line": "台词",
              "emotion": "情绪",
              "subtext": "潜台词",
              "delivery_notes": "表演提示"
            }
          ],
    
          "continuity_requirements": {
            "entering_from_previous": "从前一场景进入的方式",
            "exiting_to_next": "退出到下一场景的方式",
            "props_to_carry": ["需要携带的道具"],
            "character_state_changes": ["角色状态变化"]
          }
        }
      ],
    
      "production_planning": {
        "location_requirements": [
          {
            "scene": "场景ID",
            "location": "地点",
            "set_dressing": "场景布置要求",
            "practical_lights": "实际光源"
          }
        ],
    
        "character_tracking": {
          "costume_changes": [
            {"character": "角色", "scene": "场景", "costume": "服装"}
          ],
          "makeup_requirements": [
            {"character": "角色", "scene": "场景", "makeup": "妆容"}
          ]
        },
    
        "special_sequences": {
          "action_sequences": ["动作序列"],
          "emotional_beats": ["情绪高潮点"],
          "visual_effects_needed": ["需要的视觉效果"]
        }
      },
    
      "sora_optimization": {
        "per_scene_prompts": [
          {
            "scene": "场景ID",
            "optimized_prompt": "为Sora优化的提示词",
            "key_visuals": ["关键视觉元素"],
            "style_references": ["风格参考"]
          }
        ],
    
        "transition_prompts": [
          {
            "from_scene": "场景A",
            "to_scene": "场景B",
            "transition_type": "过渡类型",
            "sora_transition_prompt": "用于Sora的过渡提示词"
          }
        ]
      }
    }
    
    ## 结构化场景剧本内容：
    {structured_script_text}
    
    ## 分析规则：
    1. 尊重原始结构，不改变场景划分
    2. 为每个场景建议合适的镜头序列
    3. 识别对话中的情绪变化
    4. 标记需要特效或特殊拍摄的部分
    5. 确保时间逻辑连贯
    
    请输出纯净的JSON，不要任何额外文本。
    

script_parser_validator:
  name: "script_parser_prompt"
  description: "结构化场景解析"
  template: |
    你是一个剧本验证系统。请检查以下解析结果，识别问题并提供修复建议。
    
    ## 验证规则：
    1. 时间线必须连续且合理
    2. 角色名称必须一致
    3. 地点转换必须逻辑通顺
    4. 镜头描述必须可执行
    5. 情绪发展必须连贯
    
    ## 问题剧本：
    {problematic_script}
    
    ## 当前解析结果：
    {current_parsing}
    
    ## 发现的问题：
    {detected_issues}
    
    ## 请提供：
    1. 问题分类和严重程度
    2. 具体修复建议
    3. 修正后的关键字段
    4. 防止类似问题的规则
    
    输出JSON格式：
    {
      "validation_report": {
        "overall_status": "valid|needs_minor_fixes|needs_major_revision",
        "issues_found": [
          {
            "type": "问题类型",
            "description": "问题描述",
            "severity": "high|medium|low",
            "location": "问题位置",
            "suggestion": "修复建议"
          }
        ]
      },
    
      "corrected_content": {
        "timeline_fixes": [
          {"original": "原始时间", "corrected": "修正时间"}
        ],
        "character_consistency_fixes": [
          {"inconsistent_name": "不一致的名称", "standardized_to": "标准化名称"}
        ],
        "location_clarifications": [
          {"vague_location": "模糊地点", "clarified_to": "明确地点"}
        ]
      },
    
      "preventive_rules": [
        "预防规则1",
        "预防规则2"
      ]
    }