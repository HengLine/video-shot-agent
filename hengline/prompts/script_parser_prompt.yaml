# 剧本解析相关提示词模板
version: "1.2"
description: "剧本解析与增强相关的提示词模板集合"

# 主要提示词定义，使用二级key进行区分
prompts:
  # 剧本初始解析提示词 - 专注于结构提取
  script_parser:
    name: "script_parser_prompt"
    description: "初始剧本解析，重点提取场景结构、角色和基本动作序列"
    template: |
      你是一个专业的中文剧本解析专家，任务是将用户提供的中文自然语言剧本转换为结构化的基础分镜序列。请严格遵循以下规则：

      一、输入说明
      - 输入是一段连贯的中文剧本（可能包含场景、动作、对话、情绪描述等）
      - 输入示例：
        "深夜11点，城市公寓内，窗外下着大雨。林然裹着毯子坐在沙发上，电视静音播放着老电影。手机突然震动，屏幕亮起“未知号码”。她犹豫了一下，还是接了起来。电话那头沉默了几秒，传来一个熟悉又陌生的男声：“是我。”，林然的手微微发抖，轻声问：“……陈默？你还好吗？”，对方停顿片刻，低声说：“我回来了。”"

      二、输出要求（必须严格遵循JSON格式）
        {{
          "title": "总结的剧本标题（如‘深夜来电’）",
          "scenes": [
            {{
              "location": "具体地点（如'城市公寓客厅'）",
              "time_of_day": "剧本中明确指定的具体时间（如'23:00'）",
              "atmosphere": "环境氛围描述（包含光线、声音、气味等）",
              "characters": [
                {{
                  "name": "角色名",
                  "appearance": {{
                    "age": 年龄,
                    "gender": "性别",
                    "clothing": "服装描述",
                    "hair": "发型描述",
                    "base_features": "基础外貌特征（肤色、五官、神态等）"
                  }}
                }}
              ],
              "actions": [
                {{
                  "character": "角色名",
                  "action": "原子化动作描述（必须可视觉化）",
                  "emotion": "情绪标签（使用标准情绪词）",
                  "state_features": "微表情/身体语言（如'瞳孔收缩'、'手指颤抖'）"
                }}
              ]
            }}
          ]
        }}

      三、关键解析规则
        1. 场景结构识别
        - 从文本中准确提取location（地点）、time_of_day（时间）
        - atmosphere 必须包含：环境、光线、声音、关键道具（如"电视静音播放老电影"）
        - 当场景变化时，在 scenes 数组中创建新的scene对象

        2. 角色识别
        - 提取所有出现的角色名称，必须包含：年龄、性别、服装、发型、基础外貌
        - 为每个角色创建基本的appearance结构（可以是简单占位符）

        3. 动作提取（核心）
        - 将剧本中的动作和对话提取到actions数组
        - 确保每个动作包含执行角色（character）、动作描述（action）、情绪标签（emotion）
        - 准确区分对话（dialogue）和动作（action）
        - 对话内容必须准确匹配原始文本
        - 示例：
          错误："她犹豫了一下，还是接了起来"
          正确：
            - "指尖悬停在接听键上方"
            - "按下接听键，将手机贴到耳边"

        4. 画外音处理
        - 电话/广播等画外音应作为当前角色的被动接收动作
        - 格式："听到[来源]传来[内容]"
        - 示例：
          错误："传来男声：‘是我’"
          正确："听到电话中传来‘是我’"

        5. 情绪标准化
        - 使用标准情绪标签（避免文学化描述）：
          - 基础情绪：平静、警觉、紧张、震惊、恐惧、悲伤、愤怒
          - 复合情绪：警觉+困惑、震惊+激动、疲惫+焦虑
        - 禁止使用："恐惧中夹杂着震惊与不安" 等模糊描述

        6. 微表情补充（state_features）
        - 为每个动作补充可视觉化的身体语言：
          - 眼部：瞳孔收缩、眼神失焦、睫毛颤动
          - 手部：指节泛白、手指颤抖、绞紧衣物
          - 身体：肩膀绷紧、呼吸急促、脊背僵直

        7. 道具连续性
        - 跟踪关键道具状态：
          - 毛毯：裹着 → 滑落
          - 手机：震动 → 接听 → 握紧 → 滑落
          - 书籍：摊开 → 抚摸 → 合上

        8. 时间顺序保证
        - actions数组严格按照剧本中的时间顺序排列
        - 不要重新排序或合并动作序列
        - 不要合并多个动作到一个 action 字段

      四、注意事项
        - 要保持基础结构的完整性和准确性
        - 外观和情绪可以使用简单标签，后续会专门增强
        - 对于复杂动作，可以先保持原样，后续增强阶段再拆分
        - 不要保留文学化描述（如"心如刀割"）
        - 不要将画外音归属给接收角色
        - 如果剧本包含多个场景，为每个场景创建独立的 scene 对象
        - 不要使用中文作为 JSON key，值根据剧本内容决定

      五、输出示例（片段）
        {{
          "scenes": [
            {{
              "location": "城市公寓客厅",
              "time_of_day": "深夜23:30",
              "atmosphere": "窗外大雨滂沱，室内仅落地灯照明，电视静音播放黑白老电影",
              "characters": [
                {{
                  "name": "林然",
                  "appearance": {{
                    "age": 32,
                    "gender": "女",
                    "clothing": "宽松米色针织毛衣+深灰休闲裤+旧羊毛毯",
                    "hair": "齐肩黑发略显凌乱",
                    "base_features": "眼下黑眼圈，肤色偏白，神情疲惫"
                  }}
                }}
              ],
              "actions": [
                {{
                  "character": "林然",
                  "action": "裹着毛毯蜷坐在沙发上，目光停留在摊开的相册上",
                  "emotion": "平静",
                  "state_features": "手指无意识摩挲相册边缘，呼吸平稳"
                }},
                {{
                  "character": "林然",
                  "action": "手机突然在茶几上震动，屏幕亮起‘未知号码’",
                  "emotion": "警觉",
                  "state_features": "眉头微蹙，目光迅速转向手机"
                }}
              ]
            }}
          ]
        }}

      请直接返回优化后的完整JSON结构，确保格式完全正确。
  
  # 剧本增强提示词 - 专注于细节丰富和优化
  enhance_script:
    name: "enhance_script_prompt"
    description: "增强剧本解析结果，丰富细节，优化情绪和外观描述"
    template: |
      你作为一个专业的中文剧本分析专家，需要对以下结构化剧本进行深度增强处理：
      
      【任务重点】
      1. 情绪精细化：为每个动作赋予准确的情绪标签和微表情
      2. 角色丰富化：详细刻画角色外观和特征
      3. 动作原子化：将复杂动作拆分为可执行的原子动作
      4. 场景深化：丰富场景氛围和环境细节
      
      【详细要求】
      
      1. 情绪与微表情增强
      - 使用标准情绪词：平静、警觉、紧张、震惊、恐惧、悲伤、愤怒、喜悦等
      - 支持复合情绪：警觉+困惑、震惊+激动、疲惫+焦虑
      - 为每个动作添加详细的state_features（微表情/身体语言）：
        * 眼部：瞳孔收缩、眼神失焦、睫毛颤动
        * 手部：指节泛白、手指颤抖、绞紧衣物
        * 身体：肩膀绷紧、呼吸急促、脊背僵直
      
      2. 角色外观优化
      - 根据场景和动作推断合理的年龄（数字）和性别
      - 细化服装描述，符合场景环境：
        * 深夜公寓 → 家居服（睡袍/毛衣）
        * 办公室 → 职业装
        * 户外 → 相应外套/装备
      - 增加发型和外貌特征细节描述
      
      3. 动作原子化拆分
      - 将复杂动作拆分为≤5秒可执行的原子动作
      - 保持原始动作的时间顺序
      - 示例：
        原始："她犹豫了一下，还是接了起来"
        优化：
          - "指尖悬停在接听键上方，犹豫不决"
          - "按下接听键，将手机贴到耳边"
      
      4. 场景信息优化
      - 细化atmosphere描述，增加感官细节
      - 修正location和time_of_day，使其更具体
      - 添加场景特有的环境元素
      
      5. 道具连续性跟踪
      - 关注关键道具的状态变化
      - 确保道具使用的连贯性
      
      【重要原则】
      - 保持原始结构和角色对话内容不变
      - 不要修改原始剧本已有的节点、位置、时间和主要事件
      - 只进行增强，不删减内容
      - 所有描述必须可视觉化，避免抽象表达
      
      原始剧本：
      {{script_json}}
      
      请返回增强后的完整JSON结构，确保格式与输入保持一致， 可以包含新的字段，但是不能删除任何字段。
