# =============================================================================
# 剧本分镜智能体 - 剧本解析配置
# 用途：配置剧本解析所需的正则表达式模式、关键词映射和分类规则
# 版本：1.0
# 最后更新：2025-10-25
# =============================================================================

version: "1.0"
description: "剧本解析相关的配置，包括解析规则、默认参数等"

# 基础配置
script_parser_base_config:
  # 是否启用LLM增强解析
  enable_llm_enhance: true
  
  # 是否保存解析结果到文件
  save_parsed_result: true
  
  # 解析超时时间（秒）
  parse_timeout: 30

# 剧本解析规则配置
parse_rules:
  # 场景识别规则
  scene_recognition:
    # 场景开头标志
    start_patterns:
      - "场景："
      - '第\d+场'
      - "INT."
      - "EXT."
    # 场景切换标志
    transition_patterns:
      - "转场"
      - "切至"
      - "画面转到"
      - "画面切换到"
    # 场景结束标志
    end_patterns:
      - "【完】"
      - "（完）"
  
  # 角色识别规则
  character_recognition:
    # 角色名提取模式
    name_patterns:
      - '([\u4e00-\u9fa5a-zA-Z]+)[：:]'
      - '"([\u4e00-\u9fa5a-zA-Z]+)"'
    # 常见角色称谓
    common_titles:
      - "先生"
      - "女士"
      - "医生"
      - "老师"
      - "警官"
  
  # 对话识别规则
  dialogue_recognition:
    # 直接对话模式
    direct_patterns:
      - '"([\\s\\S]*?)"'
      - "['‘]([\\s\\S]*?)['’]"
    # 间接对话模式
    indirect_patterns:
      - '说道[：:][\\s\\S]*?'
      - '说[：:][\\s\\S]*?'
      - '问道[：:][\\s\\S]*?'
      - '回答[：:][\\s\\S]*?'
  
  # 情绪识别规则
  emotion_recognition:
    # 情绪关键词
    keywords:
      # 正面情绪
      positive:
        - "开心"
        - "快乐"
        - "兴奋"
        - "满意"
        - "感激"
        - "愉悦"
        - "幸福"
        - "激动"
        - "欣慰"
        - "满足"
        - "喜悦"
        - "自豪"
        - "狂喜"
        - "欢快"
        - "轻松"
      # 负面情绪
      negative:
        - "愤怒"
        - "悲伤"
        - "恐惧"
        - "焦虑"
        - "失望"
        - "沮丧"
        - "绝望"
        - "痛苦"
        - "忧郁"
        - "烦躁"
        - "委屈"
        - "怨恨"
        - "厌恶"
        - "尴尬"
        - "愧疚"
      # 中性情绪
      neutral:
        - "平静"
        - "思考"
        - "专注"
        - "好奇"
        - "疑惑"
        - "平淡"
        - "冷静"
        - "客观"
        - "理性"
        - "迷茫"
        - "困惑"
        - "犹豫"
        - "观望"
        - "等待"
        - "发呆"
  
  # 动作识别规则
  action_recognition:
    # 基本动作模式
    basic_patterns:
      - "(走|跑|跳|坐|站|躺|蹲)[\\s\\S]*?"
      - "(拿|放|取|递|接)[\\s\\S]*?"
      - "(看|听|闻|尝|摸)[\\s\\S]*?"
      - "(笑|哭|怒|惊讶|失望)[\\s\\S]*?"
    # 复杂动作模式
    complex_patterns:
      - "[\\s\\S]*?了一[下番次]"
      - "[\\s\\S]*?起来"
      - "开始[\\s\\S]*?"
      - "停止[\\s\\S]*?"
  
  # 场景元素识别规则
  scene_elements:
    # 环境描述关键词
    environment_keywords:
      - "天气"
      - "光线"
      - "温度"
      - "气味"
      - "声音"
    # 道具识别模式
    prop_patterns:
      - "(手机|电脑|书籍|文件|杯子|钥匙)[\\s\\S]*?"
      - "[\\s\\S]*?着(手机|电脑|书籍|文件|杯子|钥匙)"

# 动作拆分规则配置
action_splitting_rules:
  # 最大动作时长（秒）
  max_duration: 5
  
  # 动作拆分标记词
  split_markers:
    - "然后"
    - "接着"
    - "随后"
    - "于是"
    - "紧接着"
  
  # 复合动作拆分模式
  compound_action_patterns:
    - '([\\s\\S]*?)，然后([\\s\\S]*?)'
    - '([\\s\\S]*?)，接着([\\s\\S]*?)'
    - '先([\\s\\S]*?)，再([\\s\\S]*?)'

# 道具跟踪规则配置
prop_tracking_rules:
  # 道具出现标记词
  appearance_markers:
    - "拿起"
    - "抓起"
    - "捡起"
    - "从[\\s\\S]*?拿出"
  
  # 道具消失标记词
  disappearance_markers:
    - "放下"
    - "丢掉"
    - "丢下"
    - "放回"
    - "还给"
  
  # 道具状态变化标记词
  state_change_markers:
    - "打开"
    - "关闭"
    - "启动"
    - "停止"
    - "调整"

# 微表情补充规则配置
microexpression_rules:
  # 情绪对应的微表情
  emotion_expressions:
    开心:
      - "眼角上扬"
      - "嘴角上翘"
      - "眼睛发亮"
    悲伤:
      - "眼眶湿润"
      - "嘴角下垂"
      - "眼神黯淡"
    愤怒:
      - "眉头紧皱"
      - "双目圆睁"
      - "咬牙切齿"
    恐惧:
      - "瞳孔放大"
      - "表情僵硬"
      - "身体颤抖"
    惊讶:
      - "嘴巴微张"
      - "眼睛瞪大"
      - "眉毛上挑"

# 场景特殊处理规则
scene_special_rules:
  # 电话对话处理 - 精确匹配测试剧本中的对话模式
  - pattern: '听到对面传来熟悉的声音[：:](.*)'
    description: "听到对面传来熟悉的声音说：\"{1}\""
    emotion: "震惊"
    state_features: "身体瞬间僵直，手指关节因握力过猛而泛白，呼吸凝滞"
  - pattern: '她的手微微发抖，轻声问道[：:](.*)'
    description: "手微微发抖，轻声问道：\"{1}\""
    emotion: "紧张+试探"
    state_features: "手指无意识地绞动，眼神闪烁不定，声音微弱而颤抖"
  - pattern: '犹豫了一下，接起电话'
    description: "犹豫了一下，接起电话"
    emotion: "犹豫+警觉"
    state_features: "下唇轻咬，手指无意识地摩挲手机边缘，目光闪烁不定"
  
  # 环境转场处理
  - pattern: '镜头转到([\\s\\S]*?)'
    description: "场景切换到{1}"
    transition_type: "切镜"
  - pattern: '画面逐渐暗下'
    description: "画面逐渐暗下"
    transition_type: "淡出"

# LLM增强配置
llm_enhance_config:
  # 是否启用情绪精细化
  enable_emotion_refinement: true
  
  # 是否启用角色外观推断
  enable_character_appearance: true
  
  # 是否启用场景氛围增强
  enable_atmosphere_enhancement: true
  
  # 是否启用动作原子化拆分
  enable_action_atomization: true
  
  # 是否启用道具连续性跟踪
  enable_prop_continuity: true

# 输出格式配置
output_format_config:
  # 是否输出完整剧本结构
  output_full_structure: true
  
  # 是否输出场景元数据
  output_scene_metadata: true
  
  # 是否输出角色详细信息
  output_character_details: true
  
  # 是否输出动作序列
  output_action_sequence: true
  
  # 是否输出对话内容
  output_dialogue_content: true