# Script-to-Shot AI Agent - 生产环境配置

app:
  name: "Script-to-Shot AI Agent"
  version: "1.0.0"
  description: "脚本转分镜AI助手"

api:
  host: "0.0.0.0"
  port: 8000
  workers: 4
  reload: false
  cors_origins:
    - "https://your-domain.com"
    - "https://api.your-domain.com"
  api_prefix: "/api"
  docs_url: null  # 生产环境禁用文档
  redoc_url: null
  openapi_url: null

#################### LLM配置 #####################
llm:
  default:
    base_url: "${LLM_BASE_URL:https://api.openai.com/v1}"
    api_key: "${LLM_API_KEY}"
    model_name: "${LLM_MODEL:gpt-4o}"
    timeout: 60
    response_format: "json_object"
    temperature: 0.1
    max_tokens: 2000
    max_retries: 3
    retry_delay: 1

  # 备用llm模型配置
  fallback:
    base_url: "${LLM_FALLBACK_BASE_URL:https://api.deepseek.com}"
    api_key: "${LLM_FALLBACK_API_KEY}"
    model_name: "${LLM_FALLBACK_MODEL:deepseek-chat}"
    response_format: "json_object"
    timeout: 60
    temperature: 0.1
    max_tokens: 2000
    max_retries: 3
    retry_delay: 1

#################### 嵌入模型配置 #####################
embedding:
  default:
    base_url: "${EMBEDDING_BASE_URL:https://api.openai.com/v1}"
    api_key: "${EMBEDDING_API_KEY}"
    model_name: "${EMBEDDING_MODEL:text-embedding-3-small}"
    device: "cpu"
    normalize_embeddings: true
    dimensions: 1536
    timeout: 60
    max_retries: 3

  # 备用嵌入模型配置
  fallback:
    base_url: "${EMBEDDING_FALLBACK_BASE_URL}"
    api_key: "${EMBEDDING_FALLBACK_API_KEY}"
    model_name: "${EMBEDDING_FALLBACK_MODEL:BAAI/bge-small-zh-v1.5}"
    device: "cpu"
    timeout: 60
    max_retries: 3

#################### 分镜配置 #####################
storyboard:
  # 分镜生成配置
  generation:
    default_duration_per_shot: 5
    max_duration_deviation: 0.5
    max_retries: 2
    default_style: "realistic"
    supported_styles:
      - "realistic"
      - "cinematic"
      - "documentary"

  # 分镜结构配置
  structure:
    min_shots: 1
    max_shots: 100
    default_scenes_per_shot: 1
    enable_transitions: true
    include_dialogue: true
    include_camera_angles: true

  # 输出配置
  output:
    format: "json"
    include_timestamps: true
    include_visual_descriptions: true
    include_character_list: true
    include_location_list: true
    include_shot_duration: true

#################### 路径配置 #####################
paths:
  # 数据路径
  data:
    input: "/data/script-to-shot/input"
    output: "/data/script-to-shot/output"
    cache: "/data/script-to-shot/cache"

  # 模型路径
  models:
    base: "/data/script-to-shot/models"
    embeddings: "/data/script-to-shot/models/embeddings"
    llm_cache: "/data/script-to-shot/models/llm_cache"

  # 缓存路径
  cache:
    base: "/data/script-to-shot/cache"
    embeddings: "/data/script-to-shot/cache/embeddings"
    llm_responses: "/data/script-to-shot/cache/llm_responses"

  # 日志路径
  logs:
    base: "/var/log/script-to-shot"
    app: "/var/log/script-to-shot/app"
    api: "/var/log/script-to-shot/api"
    errors: "/var/log/script-to-shot/errors"

  # 临时文件
  temp:
    base: "/tmp/script-to-shot"
    uploads: "/tmp/script-to-shot/uploads"
    processed: "/tmp/script-to-shot/processed"

#################### 向量存储配置 #####################
vector_store:
  provider: "chroma"

  chroma:
    persist_directory: "/data/script-to-shot/vector_store"
    collection_name: "script_embeddings"
    embedding_function: "default"  # 使用embedding.default配置
    distance_metric: "cosine"

#################### 缓存配置 #####################
cache:
  # 内存缓存
  memory:
    enabled: true
    ttl: 300
    max_size: 10000

  # Redis缓存
  redis:
    enabled: true
    host: "${REDIS_HOST:localhost}"
    port: 6379
    db: 0
    password: "${REDIS_PASSWORD}"
    ttl: 3600

  # 特定缓存配置
  llm_response:
    ttl: 7200  # 2小时
    max_items: 5000

  embedding:
    ttl: 2592000  # 30天
    max_items: 50000

#################### 处理配置 #####################
processing:
  max_workers: 8
  max_concurrent_tasks: 20
  task_timeout: 600  # 10分钟

  max_retries: 5
  retry_delay: 10
  backoff_factor: 2

  batch_size: 20
  batch_timeout: 60

#################### 上传配置 #####################
upload:
  max_file_size: "50MB"
  allowed_extensions:
    - ".txt"
    - ".md"
    - ".pdf"
    - ".doc"
    - ".docx"
    - ".json"
  max_files_per_request: 10
  chunk_size: 5 * 1024 * 1024  # 5MB

#################### 监控配置 #####################
monitoring:
  health:
    enabled: true
    endpoint: "/health"
    check_interval: 60

  metrics:
    enabled: true
    endpoint: "/metrics"
    port: 9090

  tracing:
    enabled: true
    sampling_rate: 0.05

  alerting:
    enabled: true
    webhook: "${ALERT_WEBHOOK_URL}"
    error_threshold: 10

#################### 功能开关 #####################
features:
  enable_api: true
  enable_cli: false
  enable_webui: true
  enable_batch_processing: true
  enable_cache: true
  enable_validation: true
  enable_rate_limiting: true
  enable_auth: true

  rate_limits:
    requests_per_minute: 60
    requests_per_hour: 1000
    max_concurrent_requests: 50

#################### 安全配置 #####################
security:
  authentication:
    enabled: true
    jwt_secret: "${JWT_SECRET}"
    jwt_algorithm: "HS256"
    access_token_expire_minutes: 30
    refresh_token_expire_days: 7

  api_keys:
    enabled: true
    header_name: "X-API-Key"
    required_for_all_endpoints: false

  input_validation:
    max_script_length: 100000
    max_title_length: 200
    sanitize_html: true

  output_validation:
    validate_json_schema: true
    max_response_size: "10MB"